### **[REQ-GOAL-001]** Research-First Methodology
- **Type:** Technical
- **Description:** No implementation occurs until the problem space, technology landscape, and competitive analysis are finalized and approved to prevent architectural drift.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[REQ-GOAL-002]** Architecture-Driven Development (ADD)
- **Type:** Technical
- **Description:** Every project must have a validated PRD and TAS before implementation begins. Implementation agents are strictly bound by these blueprints.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[REQ-GOAL-005]** Strict TDD (Test-Driven Development) Loop
- **Type:** Technical
- **Description:** Mandatory "Red-Green-Refactor" cycle where tests are the primary source of truth for requirement fulfillment.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-001]** Agentic Observability & Traceability
- **Type:** Technical
- **Description:** Every decision, tool call, and reasoning step must be logged, queryable, and streamable in real-time.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-003]** MCP-Native Integration
- **Type:** Technical
- **Description:** Both the orchestrator and the generated code must utilize the Model Context Protocol to provide standardized interfaces for introspection, debugging, and profiling.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-035]** Structured Agent-Orchestrator Protocol (SAOP)
- **Type:** Technical
- **Description:** All interactions between the Agent Suite and the Orchestration Layer MUST follow the SAOP specification to ensure deterministic execution and transparent reasoning.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[REQ-MET-007]** Documentation Density (AOD)
- **Type:** Technical
- **Description:** Every significant module MUST include an Agent-Oriented Documentation (.agent.md) file defining intent, architecture, and agentic hooks.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[MCP-001]** Agent-Ready Code Standard
- **Type:** Technical
- **Description:** Projects generated by 'devs' must be optimized for agentic interaction ("Transparent by Design"), including requirement-tagged logic and standardized introspection points.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[MCP-002]** Glass-Box Observability Infrastructure
- **Type:** Technical
- **Description:** The system must implement a "Flight Recorder" pattern via a local SQLite database (.devs/state.sqlite) to store reasoning chains, immutable tool observations, and audit trails.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-038]** Real-time Trace Streaming (RTES)
- **Type:** UX
- **Description:** The orchestrator MUST support a websocket or SSE (Server-Sent Events) stream of the SAOP envelopes to enable real-time visualization of the agent's thought stream and tool invocations.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-001]

### **[REQ-REL-003]** Deterministic State Recovery (ACID Transitions)
- **Type:** Technical
- **Description:** Every state change (task start, tool execution, commit) must be wrapped in a SQLite transaction to ensure data integrity and atomicity.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [MCP-002]

### **[TAS-039]** Git-DB Correlation and Rewind Protocol
- **Type:** Technical
- **Description:** Every successful task completion must map to a Git Commit. The system must support a "Hard Rewind" that restores both the filesystem and the database to a consistent historical state using git-commit hashes stored in the tasks table.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [REQ-REL-003]

### **[TAS-019]** Entropy Detection and Automated Loop Prevention
- **Type:** Technical
- **Description:** The system must identify looping behavior by comparing hashes of the last 3 SAOP observation payloads. If detected, it must force an "Architectural Review" turn and a strategy pivot.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-035]

### **[REQ-UI-001]** Gated Autonomy
- **Type:** UX
- **Description:** Explicit checkpoints (e.g., PRD/TAS approval) must be enforced by the orchestrator, freezing the state machine until a resume signal is received from the user.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-023]** Secret Masking (SecretMasker)
- **Type:** Security
- **Description:** A mandatory filter in the observation pipeline must redact sensitive data (API keys, PII) using regex and entropy detection before it is stored or returned to the LLM.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-036]** OrchestratorServer (System Control)
- **Type:** Technical
- **Description:** A central MCP server that exposes the internal state machine, memory stores, HITL coordination, and task tracing for the VSCode Extension and CLI.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-003]

### **[TAS-037]** SandboxServer (Isolated Execution)
- **Type:** Security
- **Description:** An MCP server injected into an ephemeral container providing a secure, monitored interface for filesystem operations, surgical edits, shell execution, and dependency management.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-003]

### **[TAS-043]** ProjectServer (Agentic Debugging)
- **Type:** Technical
- **Description:** Every generated project MUST include an internal MCP server that enables agents to inspect application state, run tests, bridge to the database, and capture performance traces.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-003]

### **[TAS-063]** MCP Discovery & Tool Lifecycle
- **Type:** Technical
- **Description:** Agents must discover tools through MCP list_tools, with tool availability filtered by the orchestrator based on the current project phase (Discovery, Implementation, Verification).
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-064]** LangGraph State Machine
- **Type:** Technical
- **Description:** The implementation phase must be orchestrated as a cyclical LangGraph where each node (Plan, Test, Code, Refactor, Review, Commit) represents a specific agentic state or tool boundary.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-041]** Binary Gate Protocol
- **Type:** Technical
- **Description:** Transitions between LangGraph nodes must be governed by strict exit-code gates (RED, GREEN, QUALITY, VERIFY) within the sandbox environment.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-064], [TAS-037]

### **[TAS-021]** Suspended Sandbox State
- **Type:** UX
- **Description:** For failed implementation tasks, the system must preserve the execution environment (Docker/WebContainer) in a "Suspended" state to allow for manual human debugging.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-037]

### **[TAS-066]** Introspection Points and Agentic Hooks
- **Type:** Technical
- **Description:** Generated projects must include standardized introspection interfaces for core modules, documented in .agent.md files for agent use via the ProjectServer.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-043], [REQ-MET-007]

### **[TAS-016, TAS-017, TAS-018]** Tiered Memory Hierarchy
- **Type:** Technical
- **Description:** The system must implement three memory tiers: Short-Term (active task window), Medium-Term (Epic context in SQLite), and Long-Term (Project DNA in LanceDB vector store).
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-047]** Dynamic Window Composition (Short-Term Memory)
- **Type:** Technical
- **Description:** The orchestrator must dynamically construct the active context window for every turn, prioritizing the current task description, success criteria, and a summary of the TAS.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-016]

### **[TAS-048]** Active File Management
- **Type:** Technical
- **Description:** The system must allow agents to "Pin" up to 5 files to the context window simultaneously, swapping older files out to prevent token overflow.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-047]

### **[TAS-051]** Tool Result Retention
- **Type:** Technical
- **Description:** Large tool outputs must be truncated in the context window after 2 turns, while remaining fully queryable in their raw form via retrieval tools.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-047]

### **[TAS-052]** Strategy Blacklist (Medium-Term Memory)
- **Type:** Technical
- **Description:** Architectural misunderstandings identified during failure analysis must be logged as "Lessons Learned" in SQLite to prevent the agent from repeating invalid strategies.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-017]

### **[TAS-011]** LanceDB Vector Memory Implementation
- **Type:** Technical
- **Description:** Long-term memory must utilize LanceDB with text-embedding-004 to store and retrieve PRD, TAS, and global constraints via cosine similarity search.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-018]

### **[TAS-024, REQ-SYS-001]** Context Pruning and Summarization
- **Type:** Technical
- **Description:** To manage token limits, the system must perform automated context compression when thresholds are met, summarizing intermediate turns into a structured history log.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** None

### **[TAS-049]** Context Compression Trigger Thresholds
- **Type:** Technical
- **Description:** Context compression must be flagged at 600k tokens and triggered (using Gemini 1.5 Flash) at 800k tokens within the 1M token window.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-024]

### **[TAS-050]** Spec Refresh Protocol
- **Type:** Technical
- **Description:** The orchestrator must re-inject the full TAS and PRD text every 10 turns to prevent reasoning decay during long implementation cycles.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-024]

### **[MCP-009]** Agentic Profiling and Performance Guardrails
- **Type:** Non-Functional
- **Description:** The system must enforce performance constraints (CPU, memory) by comparing agent-captured runtime profiles against TAS-defined thresholds during the Refactor phase.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-043]

### **[TAS-025]** SAOP Schema Validation
- **Type:** Technical
- **Description:** The orchestrator MUST validate the JSON schema of every agent turn envelope (SAOP) before execution to ensure deterministic interaction.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-035]

### **[TAS-026]** SAOP Retry and Resume Protocols
- **Type:** Technical
- **Description:** The system must implement a "Formatting Correction" turn (max 2 retries) for malformed responses and a "Resume Protocol" for partial completions due to token limits.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-035]

### **[TAS-027]** Tool Execution Timeout Handling
- **Type:** Technical
- **Description:** If an MCP tool exceeds the 300s timeout, the system must return a TIMEOUT_EXCEEDED status to the agent, forcing a strategy reassessment.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-003]

### **[TAS-067]** Flaky Test Mitigation Protocol
- **Type:** Technical
- **Description:** The orchestrator must automatically retry failing tests twice and perform heuristic analysis to flag tests with inconsistent errors as FLAKY.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-041]

### **[TAS-068]** Root Cause Analysis (RCA) and Failure Reporting
- **Type:** Technical
- **Description:** Upon task failure, the system must perform an automated RCA to identify the root cause and generate a Markdown report with proposed fixes or requirement clarifications.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-021], [MCP-002]

### **[TAS-069]** Headless-First Orchestrator Access
- **Type:** Technical
- **Description:** The OrchestratorServer MUST be accessible via standard IPC (Unix Sockets / Named Pipes) to ensure feature parity between the CLI and VSCode Extension.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-036]

### **[TAS-070]** Sandbox Path Sanitization and Resource Quotas
- **Type:** Security
- **Description:** The SandboxServer must enforce path sanitization against the project root and implement resource capping (e.g., 4GB RSS, 100% CPU for >10s) for monitored shell commands.
- **Source:** MCP and AI Development Design (specs/3_mcp_design.md)
- **Dependencies:** [TAS-037]
