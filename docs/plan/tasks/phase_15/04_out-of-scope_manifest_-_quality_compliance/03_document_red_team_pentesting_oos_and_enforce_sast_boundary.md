# Task: Document Advanced Red-Team Penetration Testing as Out-of-Scope and Enforce SAST-Only Security Boundary (Sub-Epic: 04_Out-of-Scope Manifest - Quality & Compliance)

## Covered Requirements
- [1_PRD-REQ-OOS-013]

## 1. Initial Test Written
- [ ] In `src/oos/__tests__/oos-manifest.test.ts`, add a unit test asserting that the `OOS_MANIFEST` array contains an entry with `id: "1_PRD-REQ-OOS-013"`.
- [ ] Assert the entry has:
  - `id`: `"1_PRD-REQ-OOS-013"`
  - `name`: a string matching `"Advanced Red-Team Security Penetration Testing"`
  - `description`: a string containing `"APTs"` or `"pen-testing"` or `"network-level"`
  - `rationale`: a non-empty string
  - `futureConsideration`: `false`
- [ ] Create a test file at `src/security/__tests__/security-validation-policy.test.ts`.
- [ ] Write a unit test asserting that the security validation policy config (`src/security/security-validation-policy.ts`) has:
  - `allowRedTeamPenTesting`: `false`
  - `allowNetworkLevelPenTesting`: `false`
  - `requireSast`: `true`
  - `allowedSecurityCheckTypes`: an array containing `"sast"` and not containing `"pentest"`, `"red-team"`, or `"network-pentest"`
- [ ] Write an integration test: when the `TaskDAGBuilder` processes a security phase, assert it only emits security task types from the `allowedSecurityCheckTypes` list. Assert that if any task with type `"pentest"` or `"red-team"` is attempted, an `OosViolationError` with `oosId: "1_PRD-REQ-OOS-013"` is thrown.
- [ ] Write a test asserting that the generated project's CI config (scaffolded output) contains a SAST step but does NOT contain any red-team or network penetration testing step.

## 2. Task Implementation
- [ ] Add the `1_PRD-REQ-OOS-013` entry to `src/oos/oos-manifest.ts`:
  ```typescript
  {
    id: "1_PRD-REQ-OOS-013",
    name: "Advanced Red-Team Security Penetration Testing",
    description: "Out of Scope: No simulation of APTs or deep network-level pen-testing.",
    rationale: "Advanced red-team operations, APT simulation, and network-layer penetration testing require specialized human expertise, dedicated tooling (e.g., Metasploit, custom C2 frameworks), and legal authorization frameworks that are outside the automated agentic development pipeline. The system provides SAST (Static Application Security Testing) integration only. Projects requiring pen-testing must engage dedicated security firms post-delivery.",
    futureConsideration: false,
  }
  ```
- [ ] Create `src/security/security-validation-policy.ts` exporting:
  ```typescript
  export const SECURITY_VALIDATION_POLICY = {
    allowRedTeamPenTesting: false,
    allowNetworkLevelPenTesting: false,
    requireSast: true,
    allowedSecurityCheckTypes: ["sast", "dependency-audit", "secret-scan"],
  } as const;
  ```
- [ ] Update the `TaskDAGBuilder` to import `SECURITY_VALIDATION_POLICY` and enforce that security phase tasks only use types in `allowedSecurityCheckTypes`. Throw `OosViolationError` (referencing `1_PRD-REQ-OOS-013`) for any violation.
- [ ] Update the CI scaffold generator (e.g., `src/scaffolding/ci-config-generator.ts`) to inject a SAST step (e.g., using `semgrep` or `eslint-plugin-security`) and explicitly NOT inject any penetration testing step. Add a comment in the generated CI config referencing `1_PRD-REQ-OOS-013`.

## 3. Code Review
- [ ] Verify `SECURITY_VALIDATION_POLICY` uses `as const` for compile-time type safety.
- [ ] Confirm `OosViolationError` is thrown — not merely logged — when a forbidden security task type is requested.
- [ ] Verify the CI scaffold generator's SAST step uses a pinned, well-known tool version, not a floating `latest` tag.
- [ ] Ensure no environment variable or config flag can bypass the `allowRedTeamPenTesting: false` constraint.
- [ ] Confirm the security policy is in a dedicated module (`src/security/`) — not inlined into the orchestrator.

## 4. Run Automated Tests to Verify
- [ ] Run `npm test -- --testPathPattern=security-validation-policy` and confirm all tests pass.
- [ ] Run `npm test -- --testPathPattern=oos-manifest` and confirm the `1_PRD-REQ-OOS-013` entry assertion passes.
- [ ] Run `npm test` (full suite) and confirm zero regressions.

## 5. Update Documentation
- [ ] Add a section `## Advanced Red-Team Penetration Testing (1_PRD-REQ-OOS-013)` to `docs/oos/README.md` explaining that only SAST and dependency auditing are within scope, and listing the allowed check types.
- [ ] Update `docs/agent-memory/phase_15.agent.md` to record: "Red-team and network-level pen-testing are out of scope per [1_PRD-REQ-OOS-013]. Security validation is limited to SAST, dependency audits, and secret scans. The `TaskDAGBuilder` enforces this at construction time."
- [ ] Add a comment referencing `1_PRD-REQ-OOS-013` above the `SECURITY_VALIDATION_POLICY` object in its source file.

## 6. Automated Verification
- [ ] Extend `scripts/verify-oos-manifest.js` to assert `1_PRD-REQ-OOS-013` is present and fully populated.
- [ ] Add CI step `verify:security-policy` running `scripts/verify-security-policy.js` which:
  1. Imports `SECURITY_VALIDATION_POLICY`.
  2. Asserts `allowRedTeamPenTesting === false` and `allowNetworkLevelPenTesting === false`.
  3. Asserts `requireSast === true`.
  4. Asserts `allowedSecurityCheckTypes` does not contain `"pentest"` or `"red-team"`.
  5. Exits with code `0` on success, `1` on failure.
- [ ] Confirm CI passes on a clean run.
