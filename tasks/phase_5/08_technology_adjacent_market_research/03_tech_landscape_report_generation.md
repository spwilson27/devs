# Task: Implement Technology Landscape Markdown & Mermaid Report Generator (Sub-Epic: 08_Technology & Adjacent Market Research)

## Covered Requirements
- [1_PRD-REQ-RES-002], [9_ROADMAP-REQ-RES-002]

## 1. Initial Test Written
- [ ] Create `tests/research/test_tech_landscape_report_generator.py`.
- [ ] Write a unit test `test_report_contains_decision_matrix_section` that provides a fixture `DecisionMatrix` and asserts the generated Markdown string contains a `## Technology Decision Matrix` heading.
- [ ] Write a unit test `test_report_contains_mermaid_quadrant_block` asserting the Markdown output includes a fenced code block of type `mermaid` containing a quadrant chart with axes representing `scalability` (x) and `performance` (y), with each technology plotted.
- [ ] Write a unit test `test_report_contains_per_technology_sections` asserting a `### {technology_name}` heading and sub-sections for "Pros", "Cons", and "Trade-offs" exist for each technology in the matrix (per requirement [1_PRD-REQ-MAP-003]).
- [ ] Write a unit test `test_report_contains_agent_friendliness_column` asserting the decision matrix table in the Markdown output has an "Agent-Friendliness" column with the numeric score for every technology.
- [ ] Write a unit test `test_report_includes_ranked_recommendation` asserting the report ends with a `## Recommendation` section naming the top-ranked technology and its rationale sourced from the `DecisionMatrix`.
- [ ] Write a unit test `test_report_contains_source_citations` asserting every technology section includes a "Sources" sub-section with at least one URL hyperlink sourced from `TechLandscapeResult.raw_sources`.
- [ ] All tests must initially FAIL (red phase).

## 2. Task Implementation
- [ ] Create `src/research/reports/tech_landscape_report_generator.py`.
- [ ] Implement `TechLandscapeReportGenerator` class with:
  - `__init__(self, llm_client)`.
  - `generate(self, result: TechLandscapeResult, matrix: DecisionMatrix) -> str`: Returns a complete Markdown document string.
- [ ] The report structure must be:
  1. `# Technology Landscape Report` (title + metadata: timestamp, brief summary)
  2. `## Technology Decision Matrix` — a GFM pipe table with columns: Technology | Category | Performance | Scalability | Agent-Friendliness | Ecosystem Maturity | **Weighted Score**
  3. A `mermaid` fenced block rendering a `quadrantChart` with scalability on x-axis, performance on y-axis, and a data point for each technology using its scores.
  4. `## Technology Profiles` — one `###` subsection per technology with: Description, **Pros**, **Cons**, **Trade-offs**, Sources.
  5. `## Recommendation` — top-ranked technology name, score, and one-paragraph LLM-generated rationale.
- [ ] The Pros/Cons/Trade-offs content must be generated by calling the LLM with the technology description and scores as context.
- [ ] Source URLs in each technology section must be rendered as `[source N](url)` hyperlinks.
- [ ] Write the final report to `output/research/tech_landscape_report.md` via a `ReportWriter` utility (create `src/research/utils/report_writer.py` if it does not exist).
- [ ] Create `src/research/reports/tech_landscape_report_generator.agent.md`.

## 3. Code Review
- [ ] Verify the Mermaid quadrant chart uses valid Mermaid `quadrantChart` syntax (check against Mermaid v10+ spec).
- [ ] Verify Pros/Cons/Trade-offs sections are always present even if the LLM response is empty (fallback to `"N/A"` strings).
- [ ] Verify the `## Recommendation` section is always the last section.
- [ ] Verify all source URLs are sanitized (no raw HTML injection) before embedding in Markdown.
- [ ] Verify the `ReportWriter` creates parent directories if they do not exist.
- [ ] Confirm no LLM calls are made if `matrix.technologies` is empty — the generator must short-circuit and return a "No technologies evaluated" report.

## 4. Run Automated Tests to Verify
- [ ] Run `pytest tests/research/test_tech_landscape_report_generator.py -v` and confirm all tests pass.
- [ ] Run `pytest --cov=src/research/reports/tech_landscape_report_generator --cov-report=term-missing` and confirm line coverage ≥ 90%.

## 5. Update Documentation
- [ ] Update `src/research/reports/tech_landscape_report_generator.agent.md` with the full report schema, Mermaid syntax example, and the LLM prompt used for Pros/Cons generation.
- [ ] Add example output report snippet to `docs/examples/tech_landscape_report_sample.md`.
- [ ] Update `docs/architecture/research_agents.md` with a section describing the report generator.
- [ ] Update `CHANGELOG.md`.

## 6. Automated Verification
- [ ] Run `pytest tests/research/test_tech_landscape_report_generator.py --tb=short` and assert exit code is `0`.
- [ ] Run the generator against the fixture data: `python -m src.research.reports.tech_landscape_report_generator --fixture` and assert `output/research/tech_landscape_report.md` is created and is valid Markdown (non-empty, contains `# Technology Landscape Report`).
- [ ] Run `python scripts/verify_aod_density.py src/research/reports/` to confirm 1:1 `.py`/`.agent.md` ratio.
