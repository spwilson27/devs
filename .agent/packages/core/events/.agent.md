---
package: "@devs/core"
directory: "events"
type: directory-overview
status: active
created: 2026-02-21
requirements: ["2_TAS-REQ-018", "1_PRD-REQ-INT-004", "9_ROADMAP-REQ-037"]
---

# events/ — Cross-Process EventBus

## Purpose

Provides real-time, typed, bidirectional event delivery between the orchestration
engine, CLI, and VSCode extension using Unix Domain Sockets (UDS) as the IPC
transport.  All processes share the same event bus socket located in the
`.devs/eventbus.sock` file within the project's Flight Recorder directory.

## Modules

| File | Role |
|------|------|
| `types.ts` | Event topic registry, payload interfaces, `BusMessage` envelope |
| `EventBus.ts` | Low-level UDS server/client with NDJSON framing and reconnection |
| `SharedEventBus.ts` | High-level typed `subscribe` / `publish` API |

## Key Design Decisions

1. **Hub model** — one "server" process (orchestration engine) creates the socket
   and acts as a message hub.  All clients relay events through it, which enables
   fan-out to multiple consumers (CLI + VSCode simultaneously).

2. **NDJSON framing** — each message is serialized as a single JSON string
   terminated with `\n`, making the protocol simple, debuggable, and
   naturally fragmentation-resistant.

3. **Typed payloads** — `EventPayloadMap` maps each topic to its payload type,
   giving `subscribe` and `publish` full TypeScript inference without manual
   casts.

4. **Reconnection** — the client-side `EventBus` auto-reconnects with exponential
   back-off when the server socket closes unexpectedly.

## Socket Location

```
<project-root>/.devs/eventbus.sock
```

Use `EVENTBUS_SOCKET_NAME` from `SharedEventBus.ts` and `resolveDevsDir()`
from `persistence.ts` to construct the absolute path:

```ts
import * as path from 'node:path';
import { resolveDevsDir, EVENTBUS_SOCKET_NAME } from '@devs/core';
const socketPath = path.join(resolveDevsDir(), EVENTBUS_SOCKET_NAME);
```
